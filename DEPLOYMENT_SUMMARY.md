# üéØ –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é WIRALIS

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –§–∞–≤–∏–∫–æ–Ω ‚úÖ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä—ã–π —Ñ–∞–≤–∏–∫–æ–Ω
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ –Ω–æ–≤—ã–π —Å –∑–µ–ª–µ–Ω–æ–π –±—É–∫–≤–æ–π "W"
- **–§–∞–π–ª**: `client/public/favicon.png`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–∞—Ö

### 2. API `/api/bot/generate-code` ‚úÖ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ 500 "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞"
- **–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `TELEGRAM_BOT_API_SECRET` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω —Å–µ–∫—Ä–µ—Ç –≤ Replit Secrets
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∫–æ–¥–æ–º

### 3. API `/api/verify-code` ‚úÖ
- **–ü—Ä–æ–±–ª–µ–º–∞**: "–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î"
- **–ü—Ä–∏—á–∏–Ω–∞**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—ã–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–µ–Ω `npm run db:push` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∫–æ–¥—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- **–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã**:
  - `registration_codes` - –∫–æ–¥—ã –¥–ª—è –≤—Ö–æ–¥–∞
  - `wiralis_users` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç

## üì¶ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /var/www/wiralis.ru/
cd /var/www
sudo rm -rf wiralis.ru
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ —Å—é–¥–∞

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd wiralis.ru
npm install

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
cat > .env << EOF
DATABASE_URL=postgresql://asteron:_1337_Crystal-Madness_404_Asteron%23_banana%5Blabats%5Dbrc@147.45.224.10:5432/crystalmadness
TELEGRAM_BOT_API_SECRET=US42982557
NODE_ENV=production
EOF

# 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npm run db:push

# 5. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build

# 6. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
pm2 delete wiralis 2>/dev/null || true
pm2 start npm --name "wiralis" -- run start
pm2 save

# 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
pm2 startup
```

### Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/nginx/sites-available/wiralis`:

```nginx
# wiralis.ru
server {
    listen 80;
    server_name wiralis.ru www.wiralis.ru;
    
    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# wiralis.online
server {
    listen 80;
    server_name wiralis.online www.wiralis.online;
    
    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

–ê–∫—Ç–∏–≤–∞—Ü–∏—è:

```bash
sudo ln -sf /etc/nginx/sites-available/wiralis /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### SSL (HTTPS) –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤

```bash
sudo certbot --nginx -d wiralis.ru -d www.wiralis.ru
sudo certbot --nginx -d wiralis.online -d www.wiralis.online
```

## üîÑ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
cd /var/www/wiralis.ru
pm2 stop wiralis
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
npm install
npm run db:push
npm run build
pm2 restart wiralis
pm2 logs wiralis --lines 50
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
curl -I https://wiralis.ru/
curl -I https://wiralis.online/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–≤–∏–∫–æ–Ω–∞
curl -I https://wiralis.ru/favicon.png

# –¢–µ—Å—Ç API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
curl -X POST https://wiralis.ru/api/bot/generate-code \
  -H "Content-Type: application/json" \
  -H "X-API-Key: US42982557" \
  -d '{"telegramId": 123, "nickname": "Test", "botId": "TEST"}'

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# {"code":"ABC123","expiresAt":"...","message":"–ö–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"}
```

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | Dev (Replit) | Prod (wiralis.ru) | Prod (wiralis.online) |
|-----------|--------------|-------------------|----------------------|
| –§–∞–≤–∏–∫–æ–Ω | ‚úÖ | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è |
| API /generate-code | ‚úÖ | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è |
| API /verify-code | ‚úÖ | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ | ‚úÖ (–≤–Ω–µ—à–Ω—è—è –ë–î) | ‚úÖ (–≤–Ω–µ—à–Ω—è—è –ë–î) |
| –°–∞–π—Ç | ‚úÖ | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üîÑ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è |

## üìù –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è PostgreSQL –Ω–∞ `147.45.224.10`
2. **API –∫–ª—é—á**: `US42982557` - –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤ –±–æ—Ç–µ –∏ –≤ `.env`
3. **–ü–æ—Ä—Ç**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `5000`, Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `80/443`
4. **–§–∞–≤–∏–∫–æ–Ω**: –§–∞–π–ª `client/public/favicon.png` –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **PRODUCTION_DEPLOYMENT.md** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–µ–ø–æ–ª–∞–¥–æ–∫
- **QUICK_UPDATE.md** - –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- **CHANGELOG.md** - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéâ –ò—Ç–æ–≥

–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ –§–∞–≤–∏–∫–æ–Ω –∑–∞–º–µ–Ω–µ–Ω
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

**–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**: ~10 –º–∏–Ω—É—Ç
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ù–∏–∑–∫–∞—è (–≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
